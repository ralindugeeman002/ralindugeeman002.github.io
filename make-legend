#!/usr/bin/env bash
#
# Generate the TechStack list with ALIGNED COLUMNS
#
# Author: Dave Eddy <dave@daveeddy.com>
# License: MIT

. ./theme || exit

UNDERLINE=$'\x1b[3m'

format-box() {
    local title=$1
    shift

    if [[ -z $1 ]]; then
        return
    fi
    local cmd_re='^(\$ [^ ]+)(.*)$'
    {
        echo '%'
        local line a b c icon name url
        
        for line in "$@"; do
            IFS='%' read -r a b c <<< "$line"

            # Logic to split Icon%Name%Description
            if [[ -n $c ]]; then
                icon=$a
                name=$b
                url=$c
            else
                icon=""
                name=$a
                url=$b
            fi

            # 1. Print Placeholder (Centered over text)
            if [[ -n $icon ]]; then
                 echo "  $icon"
            fi

            # 2. Print Name & Description (ALIGNED)
            # We use printf to make sure the Name takes up exactly 15 spaces
            # This ensures the Description always starts at the same spot.
            
            if [[ $name =~ $cmd_re ]]; then
                # Special handling for command-line style items
                local cmd=${BASH_REMATCH[1]}
                local rest=${BASH_REMATCH[2]}
                echo -n "$COLOR3$cmd$RST$COLOR5$rest"
            else
                # STANDARD ITEMS:
                # %-15s means "pad with spaces until 15 chars wide"
                # We apply the color first, then print the padded name
                printf "${COLOR3}%-15s${RST}" "$name"
            fi

            echo -n '%'
            echo -n "$COLOR1$UNDERLINE$url$RST"
            echo
        done
    } | ./tools/box -s '%' -hp 1 -tc "$COLOR5" -T plain -t "$title"
}

full='false'
while getopts 'f' opt; do
    case "$opt" in
        f) full='true';;
        *) exit 1;;
    esac
done

# === TECH STACK ===
# Placeholders are kept short (__K__) for the box calculation.
legend=(
    '__K__%Linux%Operating System / Kali'
    '__B__%BurpSuite%Web Vulnerability Scanner'
    '__W__%WireShark%Network Protocol Analyzer'
    '__N__%Nmap%Network Discovery & Auditing'
)

resources=()
extras=()

if $full; then
    legend+=(
        '__M__%Metasploit%Penetration Testing Framework'
        '__P__%Python%Scripting & Automation'
    )

    resources+=(
        'Bash%Shell Scripting'
    )

    extras+=(
        'Git%Version Control'
        'Docker%Containerization'
    )
fi

format-box TechStack "${legend[@]}"
format-box Resources "${resources[@]}"
format-box Extras "${extras[@]}"