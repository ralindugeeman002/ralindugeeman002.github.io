#!/usr/bin/env bash
#
# Generate the TechStack list in a HORIZONTAL GRID (No Descriptions)
#
# Author: Dave Eddy <dave@daveeddy.com>
# License: MIT

. ./theme || exit

format-box() {
    local title=$1
    shift

    if [[ -z $1 ]]; then
        return
    fi
    local cmd_re='^(\$ [^ ]+)(.*)$'
    {
        echo '%'
        local line icon name item_str i
        
        i=0
        # Loop through items
        for line in "$@"; do
            # We strictly read only 2 parts: Icon%Name
            IFS='%' read -r icon name <<< "$line"

            # Check if Icon exists
            if [[ -n $icon ]]; then
                # Create the string: Icon + Name
                item_str="  $icon  $COLOR3$name$RST"
            else
                # Just Name (for things without icons)
                item_str="$COLOR3$name$RST"
            fi

            # PRINT SIDE-BY-SIDE
            # Pad the item with spaces so columns align neatly.
            # %-40s means "Make this string 40 chars wide"
            printf "%-40s" "$item_str"

            # LOGIC: Every 2nd item, start a new line
            ((i++))
            if (( i % 2 == 0 )); then
                echo ""      # New line
                echo " "     # Vertical Gap
            fi
        done
        
        # If we ended on an odd number (1 item left over), close the line
        if (( i % 2 != 0 )); then
            echo ""
        fi

    } | ./tools/box -s '%' -hp 1 -tc "$COLOR5" -T plain -t "$title"
}

full='false'
while getopts 'f' opt; do
    case "$opt" in
        f) full='true';;
        *) exit 1;;
    esac
done

# === TECH STACK ===
# Format is simple now: Placeholder%Name
legend=(
    '__K__%Linux'
    '__B__%BurpSuite'
    '__W__%WireShark'
    '__N__%Nmap'
)

resources=()
extras=()

if $full; then
    legend+=(
        '__M__%Metasploit'
        '__P__%Python'
    )

    resources+=(
        'Bash%Shell Scripting'
    )

    extras+=(
        'Git%Version Control'
        'Docker%Containerization'
    )
fi

format-box TechStack "${legend[@]}"
format-box Resources "${resources[@]}"
format-box Extras "${extras[@]}"