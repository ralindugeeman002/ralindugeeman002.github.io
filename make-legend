#!/usr/bin/env bash
#
# Generate the TechStack list - intended to be passed to `tools/box`
#
# Author: Dave Eddy <dave@daveeddy.com>
# Date: April 05, 2025
# License: MIT

. ./theme || exit

UNDERLINE=$'\x1b[3m'

format-box() {
    local title=$1
    shift

    if [[ -z $1 ]]; then
        return
    fi
    # Regex to detect commands (starts with $)
    local cmd_re='^(\$ [^ ]+)(.*)$'
    {
        echo '%'
        local line name url
        for line in "$@"; do
            IFS='%' read -r name url <<< "$line"

            # Check if it looks like a command ($ ...)
            if [[ $name =~ $cmd_re ]]; then
                local cmd=${BASH_REMATCH[1]}
                local rest=${BASH_REMATCH[2]}

                echo -n "$COLOR3$cmd$RST$COLOR5$rest"
            else
                # If not a command, print it in Color 3 (Green) to match the old look
                # or keep Color 5 (Purple) if you prefer. 
                # I switched it to COLOR3 here so 'Linux' pops out like the commands did.
                echo -n "$COLOR3$name$RST"
            fi

            echo -n '%'
            echo -n "$COLOR1$UNDERLINE$url$RST"
            echo
        done
    } | ./tools/box -s '%' -hp 1 -tc "$COLOR5" -T plain -t "$title"
}

full='false'
while getopts 'f' opt; do
    case "$opt" in
        f) full='true';;
        *) exit 1;;
    esac
done

# HERE IS YOUR NEW TECH STACK
# Format: Name%Description
legend=(
    'Linux%Operating System / Kali'
    'BurpSuite%Web Vulnerability Scanner'
    'WireShark%Network Protocol Analyzer'
    'Nmap%Network Discovery & Auditing'
	'Metasploit%Penetration Testing Framework'
)
resources=()
extras=()

if $full; then
    legend+=(
        'Metasploit%Penetration Testing Framework'
        'Python%Scripting & Automation'
    )

    resources+=(
        'Bash%Shell Scripting'
    )

    extras+=(
        'Git%Version Control'
        'Docker%Containerization'
    )
fi

# CHANGED TITLE TO "TechStack"
format-box TechStack "${legend[@]}"
format-box Resources "${resources[@]}"
format-box Extras "${extras[@]}"